<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="images/IMG_20231105_202217_434-removebg.png">
    <link rel="stylesheet" href="CSSFiles/Normalize.css" />
    <link rel="stylesheet" href="CSSFiles/all.min.css" />
    <link rel="stylesheet" href="CSSFiles/prof.css">
    <title>Heraf Profile</title>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <img src="images/IMG_20231105_202217_434-removebg.png" alt="Logo">
            </div>
            <i class="fas fa-bars toggle-menu"></i>
            <div class="links">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#sur">Services</a></li>
                    <li><a href="#about">About</a></li>
                </ul>
                <a href="profile.html">
                    <i class="fa-solid fa-user"></i>
                </a>
            </div>
        </div>
    </header>

    <section class="sec1">
        <div class="container">
            <div class="left">
                <p>Hi there</p>
                <h3 id="emp-name"></h3>
                <p id="emp-skills"></p>
                <p><span>My phone : </span><span id="emp-phone"></span></p>
                <div id="emp-rating"></div>
            </div>
            <div class="right">
                <div class="photo">
                    <img id="emp-photo" src="" alt="">
                </div>
            </div>
        </div>
    </section>

    <div class="projects" id="projects-section"></div>

    <div class="comments" id="comments-section"></div>

    <footer>
        <div class="container">
            <div class="content">
                <div class="card">
                    <h3>Connect with us</h3>
                    <div class="ourMail">
                        <i class="fa-solid fa-envelope"></i>
                        <span>Heraf@gmail.com</span>
                    </div>
                </div>
                <div id="sur" class="card">
                    <h3>Our service</h3>
                    <p><span style="font-weight: bold;">Heraf :</span> is a platform that provides a space for artisans of all shapes and professions to offer their services</p>
                </div>
                <div id="about" class="card">
                    <h3>About US</h3>
                    <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ipsa nobis magnam aperiam quis!</p>
                </div>
            </div>
            <hr>
            <h2>ERROR 404 TEAM</h2>
            <p style="font-size: 0.9em;">
                <i class="fa-solid fa-copyright"></i> 2023
            </p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const empId = 1; // Replace with dynamic value or from session

            // Fetch employer data
            fetch(`fetch.php?table=employer&id=${empId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const emp = data[0];
                        document.getElementById('emp-name').textContent = `${emp.first_name} ${emp.last_name}`;
                        document.getElementById('emp-phone').textContent = emp.phone;
                        document.getElementById('emp-photo').src = `images/${emp.photo}`;
                        document.getElementById('emp-rating').innerHTML = generateRatingStars(emp.rate);

                        // Fetch skills
                        return fetch(`fetch.php?table=skills&id=${emp.id}`);
                    }
                    throw new Error('Employer not found');
                })
                .then(response => response.json())
                .then(data => {
                    const skillsList = data.map(skill => `<li>${skill.skill}</li>`).join('');
                    document.getElementById('emp-skills').innerHTML = `<ul>${skillsList}</ul>`;
                    
                    // Fetch projects
                    return fetch(`fetch.php?table=projects&id=${empId}`);
                })
                .then(response => response.json())
                .then(data => {
                    const projectsHtml = data.map(proj => `
                        <div class="card">
                            <div class="left">
                                <div class="img-proj">
                                    <img src="images/${proj.photo}" alt="">
                                </div>
                            </div>
                            <div class="right">
                                <h4>${proj.project_name}</h4>
                                <p>${proj.details}</p>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('projects-section').innerHTML = `<h2>Some of my works :</h2><div class="container">${projectsHtml}</div>`;
                    
                    // Fetch reviews
                    return fetch(`fetch.php?table=review&id=${empId}`);
                })
                .then(response => response.json())
                .then(data => {
                    const commentsHtml = data.map(review => `
                        <div class="card fornum">
                            <div class="person">
                                <img src="images/${review.client_photo}" alt="">
                                <div class="name">${review.client_name}</div>
                            </div>
                            <div class="cmnt">
                                <div class="rating">
                                    ${generateRatingStars(review.rate)}
                                </div>
                                <p class="mycmnt">${review.review}</p>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('comments-section').innerHTML = `<h2>Ratings :</h2><div class="container">${commentsHtml}</div>`;
                })
                .catch(error => console.error('Error:', error));

            function generateRatingStars(rating) {
                return Array.from({ length: 5 }, (_, i) => `
                    <i class="fa-solid fa-star ${i < rating ? 'star-rated' : ''}"></i>
                `).join('');
            }
        });
    </script>
</body>
</html>
